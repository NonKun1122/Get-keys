<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>สร้าง / ต่ออายุ Key</title>
<style>
  body { font-family: Arial, sans-serif; display:flex; justify-content:center; align-items:center; height:100vh;}
  .container { text-align:center; background:#fff; padding:30px; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.2);}
  button { padding:10px 20px; font-size:16px; border:none; border-radius:8px; background:#2196F3; color:white; cursor:pointer;}
  p { margin-top:15px; font-weight:bold; }
</style>
</head>
<body>
<div class="container">
  <h1>สร้าง / ต่ออายุ Key</h1>
  <button id="generateBtn">ดำเนินการ</button>
  <p id="status"></p>
</div>

<script>
// ฟังก์ชันสร้าง key 24 ตัว
function createKey(){
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let key = '';
  for(let i=0;i<24;i++){
    key += chars.charAt(Math.floor(Math.random()*chars.length));
  }
  return key;
}

// เวลา 24 ชั่วโมง
const EXPIRE_MS = 24*60*60*1000;

document.getElementById("generateBtn").addEventListener("click", ()=>{
  const now = Date.now();
  let keyData = JSON.parse(localStorage.getItem("generatedKeyData") || "{}");
  let status = document.getElementById("status");

  // ถ้ายังไม่มี key หรือหมดอายุ
  if(!keyData.key || now > keyData.expire){
    const newKey = createKey();
    keyData = {
      key: newKey,
      expire: now + EXPIRE_MS,
      lastRenew: now
    };
    localStorage.setItem("generatedKeyData", JSON.stringify(keyData));
    status.textContent = "✅ สร้าง Key ใหม่แล้ว! รอ 10 วิ...";
  } else {
    // ตรวจสอบเวลา 1 นาทีสำหรับต่ออายุ
    if(now - keyData.lastRenew < 60000){
      status.textContent = "⏳ ต้องรออีก " + Math.ceil((60000-(now - keyData.lastRenew))/1000) + " วิ ก่อนต่ออายุ";
      return;
    }
    keyData.lastRenew = now;
    localStorage.setItem("generatedKeyData", JSON.stringify(keyData));
    status.textContent = "✅ ต่ออายุ Key เดิมเรียบร้อย! รอ 10 วิ...";
  }

  // ไปหน้า skip.html
  setTimeout(()=> window.location.href="skip.html", 1000);
});
</script>
</body>
</html>
