<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chulex Hub - Get Key</title>
<style>
body { font-family: Arial; background:#f0f0f0; display:flex; justify-content:center; align-items:center; height:100vh;}
.container { background:#fff; padding:25px; border-radius:12px; text-align:center; box-shadow:0 4px 15px rgba(0,0,0,0.2);}
button { padding:10px 18px; border:none; border-radius:8px; cursor:pointer; margin-top:10px;}
.copyBtn { background:#4CAF50; color:#fff;}
</style>
</head>
<body>
<div class="container">
  <h1>üîë ‡∏™‡∏£‡πâ‡∏≤‡∏á Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h1>
  <img id="avatar" width="150" style="border-radius:50%">
  <h2 id="username">...</h2>
  <p>UserId: <span id="userid"></span></p>
  <button id="generateBtn">‡∏™‡∏£‡πâ‡∏≤‡∏á Key ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
  <p id="keyDisplay"></p>
  <p id="expireDisplay"></p>
  <button class="copyBtn" id="copyBtn">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Key</button>
</div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const userId = urlParams.get("userId");
document.getElementById("userid").textContent = userId || "‡πÑ‡∏°‡πà‡∏û‡∏ö";

async function loadUser(){
  if(!userId) return;
  try {
    let res = await fetch(`https://users.roblox.com/v1/users/${userId}`);
    let data = await res.json();
    document.getElementById("username").textContent = data.name;
    let avatar = await fetch(`https://thumbnails.roblox.com/v1/users/avatar-headshot?userIds=${userId}&size=150x150&format=Png`);
    let img = await avatar.json();
    document.getElementById("avatar").src = img.data[0].imageUrl;
  } catch(e){ document.getElementById("username").textContent = "‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß"; }
}
loadUser();

document.getElementById("generateBtn").onclick = async () => {
  const res = await fetch(`/api/generateKey?userId=${userId}`);
  const data = await res.json();
  document.getElementById("keyDisplay").innerText = "Key: " + data.key;
  document.getElementById("expireDisplay").innerText = "‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏: " + new Date(data.expire).toLocaleString();
};
document.getElementById("copyBtn").onclick = () => {
  const text = document.getElementById("keyDisplay").innerText.replace("Key: ","");
  navigator.clipboard.writeText(text).then(()=>alert("‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Key ‡πÅ‡∏•‡πâ‡∏ß!"));
};
</script>
</body>
</html>
