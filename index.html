<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chulex Hub - Key System</title>
<style>
  body { font-family: Arial,sans-serif; background:#111; color:#fff; text-align:center; padding:20px;}
  input, button { padding:10px; margin:5px; font-size:14px; }
  img { border-radius:50%; margin:10px 0; }
  #playerInfo, #keyInfo { margin-top:15px; }
  a { color:#0af; text-decoration:none; }
</style>
</head>
<body>

<h2>üîë Chulex Hub - Get Key</h2>

<input id="userId" placeholder="‡πÉ‡∏™‡πà UserId ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
<button onclick="loadPlayer()">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>

<div id="playerInfo">‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>

<button onclick="genKey()">‡∏™‡∏£‡πâ‡∏≤‡∏á Key</button>

<div id="keyInfo"></div>

<script>
let keyData = null;
let lastGenerate = 0;

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
async function loadPlayer() {
  const userId = document.getElementById("userId").value.trim();
  if (!userId) return alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà UserId");

  try {
    const res = await fetch(`/api/player?userId=${userId}`);
    const data = await res.json();

    if (data.success) {
      document.getElementById("playerInfo").innerHTML = `
        <img src="${data.avatar}" width="100"><br>
        üë§ <b>${data.displayName}</b> (@${data.name})<br>
        üÜî ${data.userId}
      `;
    } else {
      document.getElementById("playerInfo").innerText = data.reason;
    }
  } catch (err) {
    document.getElementById("playerInfo").innerText = "‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß";
  }
}

// ‡∏™‡∏£‡πâ‡∏≤‡∏á Key ‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 1 Key
async function genKey() {
  const userId = document.getElementById("userId").value.trim();
  if (!userId) return alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà UserId");

  const now = Date.now();
  if (lastGenerate && new Date(lastGenerate).toDateString() === new Date(now).toDateString()) {
    return alert("‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á Key ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ");
  }

  try {
    const res = await fetch(`/api/keys?action=gen&userId=${userId}`);
    const data = await res.json();

    if (data.success) {
      keyData = data;
      lastGenerate = now;
      showKey(userId);
    } else {
      alert(data.reason || "‚ùå ‡∏™‡∏£‡πâ‡∏≤‡∏á Key ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    }
  } catch (err) {
    alert("‚ùå ‡∏™‡∏£‡πâ‡∏≤‡∏á Key ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  }
}

function showKey(userId) {
  if (!keyData) return;

  const keyInfo = document.getElementById("keyInfo");
  keyInfo.innerHTML = `
    ‚úÖ Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <b>${keyData.key}</b><br>
    ‚è≥ ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏: ${new Date(keyData.expire).toLocaleString()}<br>
    <button onclick="copyText('${keyData.key}')">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Key</button>
    <button onclick="copyText('https://get-keys-chulexhubx.vercel.app/?userId=${userId}')">üîó ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå</button>
  `;
}

// ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
function copyText(text) {
  navigator.clipboard.writeText(text).then(()=> alert("‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!"));
}
</script>

</body>
</html>
